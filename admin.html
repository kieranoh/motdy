<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자 예약 관리</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>관리자 예약 관리</h1>
  <div id="login-form">
    <input id="email" type="email" placeholder="이메일"><br>
    <input id="pass" type="password" placeholder="비밀번호"><br>
    <button id="btn-login">로그인</button>
  </div>

  <div id="manage" style="display:none;">
    <p><button id="btn-logout">로그아웃</button></p>
    <form id="slot-form">
      시작일: <input type="date" id="start-date" required>
      종료일: <input type="date" id="end-date" required><br>
      시작시간: <input type="time" id="start-time" required>
      종료시간: <input type="time" id="end-time" required><br>
      <button>생성하기</button>
    </form>
    <ul id="slot-list-admin"></ul>
  </div>

  <script src="js/app.js"></script>
  <script>
    const app = firebase.app();
    const auth = firebase.auth();
    const db = firebase.firestore();

    // 로그인
    document.getElementById('btn-login').onclick = async () => {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('pass').value;
      try {
        await auth.signInWithEmailAndPassword(email, pass);
        if (!auth.currentUser.token.admin) throw '권한 없음';
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('manage').style.display = 'block';
        loadAdminSlots();
      } catch (e) {
        alert('로그인 실패');
      }
    };
    document.getElementById('btn-logout').onclick = () => auth.signOut().then(() => location.reload());

    // 슬롯 생성
    document.getElementById('slot-form').onsubmit = async e => {
      e.preventDefault();
      const sd = document.getElementById('start-date').value;
      const ed = document.getElementById('end-date').value;
      const st = document.getElementById('start-time').value;
      const et = document.getElementById('end-time').value;
      let d = new Date(sd);
      const end = new Date(ed);
      while (d <= end) {
        const date = d.toISOString().slice(0,10);
        await db.collection('availability').add({ date, start: st, end: et });
        d.setDate(d.getDate()+1);
      }
      loadAdminSlots();
    };

    // 관리자 슬롯 리스트
    async function loadAdminSlots() {
      const ul = document.getElementById('slot-list-admin');
      ul.innerHTML = '';
      const snap = await db.collection('availability')
        .orderBy('date').orderBy('start').get();
      for (let doc of snap.docs) {
        const data = doc.data();
        const li = document.createElement('li');
        li.textContent = `${data.date} ${data.start}~${data.end}`;
        ul.appendChild(li);
      }
    }
  </script>
</body>
</html>